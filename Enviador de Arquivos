import socket
import os
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

host = ''
port = 1234

chunk_list = []

def quit():

    s.close()
    exit(0)
	

def getSize(filename):
    st = os.stat(filename)
    return st.st_size

def Client(filename):

    photo = open('client.jpg', 'wb')

    s.connect ( (host,port) )
  
    packet = s.recv(1000)
    while (packet):

      photo.write(packet)
      packet = s.recv(1000)
  
    photo.close()
    print "Cliente recebeu o arquivo " + filename
    quit()


def Server(filename):

    try:
        variavel = (host,port)
        s.bind( variavel )
    except socket.error as e:
        print e
        exit(0)

    s.listen(2)

    conn, addr = s.accept()

    photo = open(filename, 'rb')

    porc = 0.0
    sent = 0.0
    size = getSize(filename)
    chunk = photo.read(1000)
    chunk_index = 0;

    while (chunk):
        
      porc = (sent/size) * 100  # calcula a porcentagem
      sent = sent + 1000                     # enviados de 1000 em 1000 bytes

      chunk_list.append(chunk_index)          # adiciona o numero do pacote atual na lista
      chunk_index = chunk_index + 1           # incrementa o numero do pacote

      print porc                              # imprime a porcentagem
      conn.send(chunk)        
      chunk = photo.read(1000)      

    photo.close()


    print chunk_list
    print size
    print "Done Sending"
    quit()

def TicTacToe():

    opt = raw_input('digite s ou c:')
    if(opt == 's'):
        Server("bucky.jpg")
    else:
        Client("bucky.jpg")

TicTacToe()
